###############################################################
###############################################################
##This code will:
##1. Read a lab file in HTS format into a Praat TextGrid
##   with a single tier ("phone")
##2. Load both the audio and labels as objects
##3. open the aligned TextGrid and phonetic tier for editing
###############################################################
###############################################################

#Allow Input
form Info
    sentence Lab_file_dir /home/user_name/1.lab
endform

clearinfo

#read the .lab file into praat

tgID = undefined
stringID = Read Strings from raw text file: lab_file_dir$
numberOfStrings = Get number of strings

for stringNumber to numberOfStrings
    selectObject: stringID
    line$ = Get string: stringNumber
<<<<<<< HEAD

    time_start = extractNumber(line$, "")
    time_end   = extractNumber(line$, " ")
    label$     = replace_regex$(line$, ".*\s(.*)$", "\1", 1)

    @replace: time_start
    time_start  = replace.number

    @replace: time_end
    time_end  = replace.number

    if tgID == undefined
        tgID = Create TextGrid: 0, time_end, "token", ""
        Rename: "Labels"
    else
        selectObject: tgID
        duration = Get total duration
        nocheck Extend time: time_end - duration, "End"
    endif

    #Insert boundaries
    nocheck Insert boundary: 1, time_start
    nocheck Insert boundary: 1, time_end
    interval = Get low interval at time: 1, time_end
    Set interval text: 1, interval, label$
=======

    if !index_regex(line$, "^\s*//")
        stringID_parsed = Create Strings as tokens: line$
        nStrings_parsed = Get number of strings

        #Get info from each column
        time_start$ = Get string: 1
        time_end$ = Get string: 2
        phone$ = Get string: 3

        @replace: time_start$
        time_start  = number(replace.string$)

        @replace: time_end$
        time_end  = number(replace.string$)

        time_mid = ((time_end-time_start)/2)+time_start

        left = index(phone$, "-")
        left += 1
        right = index(phone$, "+")
        right = right - left
        phone$ = mid$  (phone$, left, right)

        removeObject: stringID_parsed

        #4. write information in TextGrid format.
        tmin = 0 ;
        tmax = 1;

        selectObject: tgID
    #Insert boundaries
        nocheck Insert boundary: 1, time_start
        nocheck Insert boundary: 1, time_end
        interval = Get interval at time: 1, time_mid
        Set interval text: 1, interval, phone$
    endif
>>>>>>> 67abb9a44cc4675857a5c243de5b66735a3fb86e
endfor

removeObject: stringID
<<<<<<< HEAD
selectObject: tgID
Replace interval text: 1, 0, 0, "^.*?-([^+]*?)\+.*", "\1", "Regular Expressions"
=======
selectObject: soundID, tgID
>>>>>>> 831c8503219eb043766b7891d6d8dc10a9d22208

#string replace to format time in seconds
procedure replace: .number
    .number /= 1e7
endproc
